<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>后台登录</title>
		<meta name="description" content="Restyling jQuery UI Widgets and Elements" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="css/ace.min.css" id="main-ace-style" />
		<script type="text/javascript" src="../easyui/js/jquery-1.12.4.js"></script>
   		<script type="text/javascript" src="../easyui/js/jquery.easyui.min.js"></script>
		<script type="text/javascript" src="../easyui/js/easyui-lang-zh_CN.js"></script>
		<script type="text/javascript" src="../js/jQuery-1.9.1.js"></script>
		<script type="text/javascript" src="../js/showpic.js"></script>
		<script type="text/javascript" src="../js/ajaxfileupload.js"></script>
		<script type="text/javascript" src="../js/city.js"></script>
	</head>
	<style>
		#show-pic{
			width:100%;
			height:100px;
		}
		#show-license{
			position:absolute;
			left:350px;
			top:350px;
		}
		#signup-box select{
			width:150px;
		}
		#signup-box input{
			width:200px;
		}
	</style>
	<body class="login-layout blur-login">
		<div class="main-container">
			<div class="main-content">
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<div class="login-container">
							<div class="center">
								<h1>
									<span class="white">后台登录系统</span>
								</h1>
							</div>

							<div class="space-6"></div>

							<div class="position-relative">
								<div id="login-box" class="login-box visible widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header blue lighter bigger">
												<i class="ace-icon fa fa-coffee green"></i>
												输入登录信息
											</h4>

											<div class="space-6"></div>

											<form>
												<fieldset>
												<label class="block clearfix">
														<span class="block input-icon input-icon-right">
													    角&nbsp;&nbsp;&nbsp;&nbsp;色：<select style="width:100px" id="rule">
																<option value=1>管理员</option>
																<option value=2>店家</option>
															</select>
														</span>
													</label>
													
													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															用户名：<input id="uname" type="text" style="display:inline" placeholder="用户名" />
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															密&nbsp;&nbsp;&nbsp;&nbsp;码：<input type="password"  id="pwd" style="display:inline" placeholder="密码" />
														</span>
													</label>

													<div class="space"></div>

													<div class="clearfix">
													
													<button type="button"class="width-35 pull-left btn btn-sm btn-primary" onclick="login()">
														<span class="bigger-110">登录</span>
													</button>
													<button type="reset" class="width-30 pull-right btn btn-sm" onclick="loginReset()">
															<span class="bigger-110">重置</span>
														</button>
													
													
												</div>

													<div class="space-4"></div>
												</fieldset>
											</form>

										</div><!-- /.widget-main -->

										<div class="toolbar clearfix">
										<div></div>
											<div>
												<a href="#" data-target="#signup-box" class="user-signup-link" >
													店家注册
												</a>
											</div>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.login-box -->

								<div id="signup-box" class="signup-box widget-box no-border" style="width:800px;position:absolute;left:-200px">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header green lighter bigger">
												店家注册
											</h4>
											<div class="space-6"></div>
											<div id="reginfo">
											<label class="block clearfix">店铺类型：
											<select id="storetype-list"></select>
											</label>
											
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">店铺名称：<input type="text"  style="display:inline" id="storename"/></span>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">店铺密码：<input type="password" id="storepwd" style="display:inline"/></span>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												省份：<select id="province"><option value="">--请选择--</option></select>&nbsp;&nbsp;&nbsp;&nbsp;
												城市：<select id="city"><option value="">--请选择--</option></select>&nbsp;&nbsp;&nbsp;&nbsp; 
												地区：<select id="area"><option value="">--请选择--</option></select>
												</span>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">详细地址：<input type="text" id="addr" style="display:inline"/></span>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">预约电话：<input type="text" id="tel" style="display:inline"/></span>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">营业时间：<input type="text" id="runtime" style="display:inline"/></span>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">营业执照：<input type="file" id='license' name="license" size="40" onchange="setImagePreviews(this,'show-license')" style="display:inline"></span>
												<div id="show-license"></div>
											</label>
											<label class="block clearfix">
												<span class="block input-icon input-icon-right">店铺图片：<input type="file" id='pic' name="pic" size="40" onchange="setImagePreviews(this,'show-pic')" style="display:inline" multiple="multiple"></span>
											</label>
											<div id="show-pic"></div>
											<button type="reset" class="pull-right btn btn-sm" style="width:100px;margin-right:220px;margin-top:-10px" onclick="regReset()">
													<span class="bigger-110">重置</span>
											</button>
											<button type="button" class=" pull-left btn btn-sm btn-success"  style="width:100px;margin-left:220px;margin-top:-10px" onclick="register()">
												<span class="bigger-110">注册</span>
											</button>
											</div>
										</div>
										<div class="toolbar center">
											<a href="#" data-target="#login-box" class="back-to-login-link">返回登录</a>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.signup-box -->
							</div><!-- /.position-relative -->

						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.main-content -->
		</div><!-- /.main-container -->
		<script type="text/javascript">
			//界面切换
			jQuery(function($) {
			 $(document).on('click', '.toolbar a[data-target]',function(){
					var target = $(this).data('target');
					$('.widget-box.visible').removeClass('visible');
					$(target).addClass('visible');
			 });
			});
			//显示店铺类型
			$(function(){
				$.get('../storeTypeServlet',{op:"findAll"},function(data){
					$.each(data,function(index,item){
						$('#storetype-list').append("<option value='"+item.stid+"'>"+item.stname+"</option>");
					});
				},'json');
			});
			//店家注册
			function register(){
				var stid=$('#storetype-list').val();
				var sname=$("#storename").val();
				var pwd=$("#storepwd").val();
				var province=$("#province").val();
				var city=$("#city").val();
				var area=$("#area").val();
				var addr=$("#addr").val();
				var tel=$("#tel").val();
				var runtime=$("#runtime").val();
				if(sname=="" || pwd=="" ||province==""||city==""||area==""||addr==""||tel==""||runtime==""){
					alert("请完善资料后再注册！");
					return;
				}
				$.ajaxFileUpload({
					url : '../storeServlet?op=addStore',
					secureuri : false,
					fileElementId : ['license','pic'],
					dataType : "text",
					data : { stid:stid,sname : sname,pwd : pwd,pro : province,city : city,area : area,addr : addr,tel : tel,runtime : runtime},
					success : function(data, status) {
						data = $.trim(data);
						if (data == 1) {
							$('#reginfo input').val("");
							$('#show-pic').html("");
							$('#show-license').html("");
							alert('店铺注册成功，等待审核中...');
						} else {
							alert('店铺注册失败请稍后再试...');
						}
					},
					error:function(data,status,error){
						alert(error);
					}
				});
				
			}
			//登录
			function login(){
				var rule=$('#rule').val();
				var back;
				var uname=$("#uname").val();
				var pwd=$("#pwd").val();
				var href;
				if(rule==1){
					back="../adminServlet";
					href='manager/index.html';
				}else if(rule==2){
					back="../storeServlet";
					href="business/business.html";
				}
				if(uname==""||pwd==""){
					return;
				}
				$.post(back,{op:"login",uname:uname,pwd:pwd},function(data){
					console.log(data);
					if(data==1){
	    				location.href=href;
					}else{
						alert("用户名或密码错误");
					}
				},'text');
			}
			
			//登录框重置
			function loginReset(){
				$("#uname").val("");
				$("#pwd").val("");
			}
			
			function regReset(){
				$('#reginfo input').val("");
				$('#show-pic').html("");
				$('#show-license').html("");
			}
		</script>
	</body>
</html>
